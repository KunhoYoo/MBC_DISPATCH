<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>배차 신청서</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    /* NanumBarunGothic from Noonnu CDN */
    @font-face {
      font-family: 'NanumBarunGothic';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-07@1.0/NanumBarunGothic.woff') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    :root {
      --primary:#2d6cdf;
      --bg:#f6f7fb;
      --card:#fff;
      --text:#222;
      --muted:#4b5563;
      --border:#e5e7eb;
      --radius:14px;
      --pad:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{-webkit-text-size-adjust:100%}
    body {
      font-family: 'NanumBarunGothic','Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
      line-height: 1.42;
    }
    .form-container {
      width: min(720px, 100%);
      margin-inline: auto;
      padding: 8px clamp(10px, 3.5vw, 18px) 18px;
    }
    h2 {
      text-align: center;
      color: var(--primary);
      margin: 8px 0 10px; /* 상단 여백 좁힘 */
      font-size: clamp(20px, 4.8vw, 28px);
      letter-spacing: 0.02em;
      font-weight: 700;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 2px 10px rgba(0,0,0,.05);
      margin-bottom: 12px;
      padding: var(--pad);
      border: 1px solid var(--border);
    }
    .card h3 {
      margin: 0 0 10px;
      font-size: clamp(13px, 3.6vw, 16px);
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
      font-weight: 700;
    }
    .field {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
      margin-bottom: 10px;
    }
    .field label {
      font-size: clamp(12px, 3.4vw, 14px);
      color: #111;
    }
    .input-row {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 8px;
    }
    /* Stack on narrow screens */
    @media (max-width: 480px) {
      .input-row {
        grid-template-columns: 1fr;
        gap: 6px;
      }
      .input-row span.separator {
        display: none;
      }
    }
    /* Inputs */
    .field input[type="text"],
    .field input[type="date"],
    .field input[type="time"] {
      width: 100%;
      padding: 12px 12px;
      font-size: 16px; /* >=16px to prevent iOS zoom */
      border: 1px solid #cfd5db;
      border-radius: 10px;
      background: #fff;
      outline: none;
      min-height: 44px; /* touch target */
    }
    .field input:focus{border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45,108,223,.12);}
    /* Checkbox pill group */
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .checkbox-group input[type="checkbox"] { display: none; }
    .checkbox-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      font-size: 15px;
      border-radius: 999px;
      border: 1px solid #cfd5db;
      background: #f9fafb;
      cursor: pointer;
      user-select: none;
      transition: background .2s, border-color .2s, color .2s, transform .05s;
      min-height: 40px;
    }
    .checkbox-pill:active { transform: scale(.98); }
    .checkbox-group input[type="checkbox"]:checked + .checkbox-pill {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
      font-weight: 700;
    }
    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 8px;
    }
    .btn {
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      color: #fff;
      min-height: 48px;
      letter-spacing: .02em;
    }
    .btn-save { background: var(--primary); }
    .btn-save:active { filter: brightness(.95); }
    .btn-reset { background: #ea4335; }
    .btn-reset:active { filter: brightness(.95); }
    .muted {
      font-size: 12px;
      color: #6b7280;
      text-align: center;
      margin-top: 8px;
    }
    /* Safe area for iPhone (notch) */
    .form-container { padding-top: max(8px, env(safe-area-inset-top)); padding-bottom: max(18px, env(safe-area-inset-bottom)); }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>배차 신청서</h2>

    <form id="dispatchForm" autocomplete="on">
      <div class="card">
        <h3>신청 정보</h3>
        <div class="field">
          <label for="dept">신청부서</label>
          <input type="text" id="dept" inputmode="text" value="취재2부">
        </div>
        <div class="field">
          <label for="passenger">탑승자명</label>
          <input type="text" id="passenger" inputmode="text" placeholder="예) 홍길동">
        </div>
        <div class="field">
          <label for="position">직급</label>
          <input type="text" id="position" inputmode="text" placeholder="예) VJ, PD, 차장, 부장">
        </div>
        <div class="field">
          <label for="tel">연락처(내선)</label>
          <input type="text" id="tel" inputmode="numeric" value="0945" placeholder="예) 0945">
        </div>
        <div class="field">
          <label for="hp">연락처(H.P)</label>
          <input type="text" id="hp" inputmode="tel" placeholder="010-0000-0000">
        </div>
      </div>

      <div class="card">
        <h3>운행 일정</h3>
        <div class="field">
          <label>배차일자</label>
          <div class="input-row">
            <input type="date" id="dateStart">
            <span class="separator" aria-hidden="true">~</span>
            <input type="date" id="dateEnd">
          </div>
        </div>
        <div class="field">
          <label>배차시간</label>
          <div class="input-row">
            <input type="time" id="timeStart" step="300">
            <span class="separator" aria-hidden="true">~</span>
            <input type="time" id="timeEnd" step="300">
          </div>
        </div>
        <div class="field">
          <label>운행 구분</label>
          <div class="checkbox-group" id="driveType">
            <input id="dt_rb" type="checkbox" value="왕복"><label for="dt_rb" class="checkbox-pill">왕복</label>
            <input id="dt_od" type="checkbox" value="편도"><label for="dt_od" class="checkbox-pill">편도</label>
            <input id="dt_pk" type="checkbox" value="픽업"><label for="dt_pk" class="checkbox-pill">픽업</label>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>배차 장소</h3>
        <div class="checkbox-group" id="location">
          <input id="loc_bs" type="checkbox" value="방송센터" checked><label for="loc_bs" class="checkbox-pill">방송센터</label>
          <input id="loc_dc" type="checkbox" value="드림센터"><label for="loc_dc" class="checkbox-pill">드림센터</label>
          <input id="loc_et" type="checkbox" value="기타"><label for="loc_et" class="checkbox-pill">기타</label>
        </div>
      </div>

      <div class="card">
        <h3>업무 및 행선지</h3>
        <div class="field">
          <label for="destination">행선지</label>
          <input type="text" id="destination" inputmode="text" placeholder="예) 서울역">
        </div>
        <div class="field">
          <label for="task">업무내용</label>
          <input type="text" id="task" inputmode="text" value="취재">
        </div>
      </div>

      <div class="card">
        <h3>차량 정보</h3>
        <div class="field">
          <label for="people">탑승인원</label>
          <input type="text" id="people" inputmode="numeric" value="2" placeholder="예: 2">
        </div>
        <div class="field">
          <label>희망 차량</label>
          <div class="checkbox-group" id="vehicle">
            <input id="vh_sd" type="checkbox" value="승용차"><label for="vh_sd" class="checkbox-pill">승용차</label>
            <input id="vh_vn" type="checkbox" value="승합차"><label for="vh_vn" class="checkbox-pill">승합차</label>
            <input id="vh_mb" type="checkbox" value="미니버스"><label for="vh_mb" class="checkbox-pill">미니버스</label>
            <input id="vh_lb" type="checkbox" value="대형버스"><label for="vh_lb" class="checkbox-pill">대형버스</label>
          </div>
        </div>
        <div class="field">
          <label>운행 구분</label>
          <div class="checkbox-group" id="driveOption">
            <input id="op_dr" type="checkbox" value="기사포함운행" checked><label for="op_dr" class="checkbox-pill">기사포함운행</label>
            <input id="op_self" type="checkbox" value="자가운전"><label for="op_self" class="checkbox-pill">자가운전</label>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-save" id="btnSave">저장</button>
        <button type="button" class="btn btn-reset" id="btnReset">리셋</button>
      </div>
    </form>

    <p class="muted">※ 서버 동기화 없음. 해당 기기/브라우저에만 로컬 저장됩니다.</p>
  </div>

  <script>
    // ---------- Local-only autosave (localStorage) ----------
    const STORAGE_KEY = 'dispatchForm:v2-mobile';

    const qs = (sel, root=document)=>root.querySelector(sel);
    const qsa = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

    function getFormData(){
      return {
        dept: qs('#dept').value,
        passenger: qs('#passenger').value,
        position: qs('#position').value,
        tel: qs('#tel').value,
        hp: qs('#hp').value,
        dateStart: qs('#dateStart').value,
        dateEnd: qs('#dateEnd').value,
        timeStart: qs('#timeStart').value,
        timeEnd: qs('#timeEnd').value,
        destination: qs('#destination').value,
        task: qs('#task').value,
        people: qs('#people').value,
        driveType: qsa('#driveType input[type=checkbox]:checked').map(el=>el.value),
        location: qsa('#location input[type=checkbox]:checked').map(el=>el.value),
        vehicle: qsa('#vehicle input[type=checkbox]:checked').map(el=>el.value),
        driveOption: qsa('#driveOption input[type=checkbox]:checked').map(el=>el.value),
      };
    }
    function setFormData(data){
      if(!data) return;
      const map = {
        dept:'#dept', passenger:'#passenger', position:'#position', tel:'#tel', hp:'#hp',
        dateStart:'#dateStart', dateEnd:'#dateEnd', timeStart:'#timeStart', timeEnd:'#timeEnd',
        destination:'#destination', task:'#task', people:'#people'
      };
      Object.entries(map).forEach(([k,sel])=>{
        if(data[k]!==undefined) qs(sel).value = data[k];
      });
      [['#driveType','driveType'], ['#location','location'], ['#vehicle','vehicle'], ['#driveOption','driveOption']]
        .forEach(([sel,key])=>{
          const setVals = new Set(data[key]||[]);
          qsa(`${sel} input[type=checkbox]`).forEach(i=> i.checked = setVals.has(i.value));
        });
    }
    function saveLocal(){
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(getFormData())); }
      catch(e){ console.warn('로컬 저장 실패:', e); }
    }
    function loadLocal(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) setFormData(JSON.parse(raw));
      } catch(e){ console.warn('로컬 불러오기 실패:', e); }
    }
    function clearLocal(){ localStorage.removeItem(STORAGE_KEY); }

    function attachAutosave(){
      qsa('input').forEach(el=>{
        el.addEventListener('input', saveLocal, {passive:true});
        el.addEventListener('change', saveLocal, {passive:true});
      });
    }

    // ---------- Clipboard Save / Reset ----------
    function buildSummaryText(){
      const d = getFormData();
      const safe = (v, alt='미입력') => (v && String(v).trim().length ? v : alt);
      const opt = (arr, alt='미선택') => (arr && arr.length ? arr.join(', ') : alt);

      return `신청부서 : ${safe(d.dept)}
탑승자명 : ${safe(d.passenger)}
직급 : ${safe(d.position)}
연락처(내선) : ${safe(d.tel,'미입력')}
연락처(H.P) : ${safe(d.hp,'')}
배차 시작 일자 : ${safe(d.dateStart,'미정')}
배차 종료 일자 : ${safe(d.dateEnd,'미정')}
배차 시작 시간 : ${safe(d.timeStart,'미정')}
배차 종료 시간 : ${safe(d.timeEnd,'미정')}
운행구분 : ${opt(d.driveType)}
배차장소 : ${opt(d.location)}
행선지 : ${safe(d.destination)}
업무내용 : ${safe(d.task)}
탑승인원 : ${safe(d.people)}명
희망차량 : ${opt(d.vehicle)}
운행옵션 : ${opt(d.driveOption)}`;
    }

    function saveForm(){
      const text = buildSummaryText();
      navigator.clipboard.writeText(text).then(()=>{
        alert('클립보드에 저장되었습니다!');
      }).catch(()=>{
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert('클립보드에 저장되었습니다!');
      });
    }

    function resetForm(){
      if(confirm('Default 값을 제외한, 모든 내용을 초기화 하시겠습니까?')){
        qs('#dispatchForm').reset();
        // defaults
        qs('#dept').value = '취재2부';
        qs('#tel').value = '0945';
        qs('#task').value = '취재';
        qs('#people').value = '2';
        // checkbox defaults
        qsa('#location input[type=checkbox]').forEach(i=>i.checked=false);
        qsa('#driveOption input[type=checkbox]').forEach(i=>i.checked=false);
        qs("#loc_bs").checked = true;
        qs("#op_dr").checked = true;
        clearLocal();
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      loadLocal();
      attachAutosave();
      qs('#btnSave').addEventListener('click', saveForm);
      qs('#btnReset').addEventListener('click', resetForm);
    }, {once:true});
  </script>
</body>
</html>


